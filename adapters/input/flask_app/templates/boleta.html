<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boleta de Venta - Oftalmetryc</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Mismos estilos que antes, no es necesario cambiarlos */
        .boleta-container { max-width: 600px; margin: 0 auto; background: white; border: 2px solid #333; border-radius: 10px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .boleta-header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 20px; }
        .boleta-title { font-size: 24px; font-weight: bold; color: #333; margin: 0; }
        .boleta-subtitle { font-size: 14px; color: #666; margin: 5px 0; }
        .boleta-section { margin-bottom: 20px; }
        .boleta-section h5 { border-bottom: 1px solid #ddd; padding-bottom: 5px; color: #333; font-weight: bold; }
        .boleta-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .boleta-total { border-top: 2px solid #333; padding-top: 10px; margin-top: 20px; font-weight: bold; font-size: 18px; }
    </style>
</head>
<body class="bg-light">
    <div class="container mt-4">
        <div class="boleta-container">
            <div class="boleta-header">
                <h1 class="boleta-title">OFTALMETRYC</h1>
                <p class="boleta-subtitle">Especialistas en Salud Visual</p>
                <div class="boleta-row mt-3">
                    <span><strong>N° Venta:</strong> {{ venta.venta_id }}</span>
                    <!-- AHORA USAMOS el objeto 'venta' que trae todo -->
                    <span><strong>Fecha:</strong> {{ venta.fecha_venta.strftime('%d-%m-%Y %H:%M') }}</span>
                </div>
            </div>

            <!-- Información del cliente -->
            <div class="boleta-section">
                <h5><i class="fas fa-user"></i> Cliente</h5>
                <!-- AHORA ACCEDEMOS a venta.cliente -->
                {% if venta.cliente %}
                <div class="boleta-row">
                    <span><strong>Nombre:</strong></span>
                    <span>{{ venta.cliente.nombres }} {{ venta.cliente.ap_pat }}</span>
                </div>
                <div class="boleta-row">
                    <span><strong>Teléfono:</strong></span>
                    <span>{{ venta.cliente.telefono }}</span>
                </div>
                {% else %}
                <div class="boleta-row">
                    <span><strong>Nombre:</strong></span>
                    <span>Sin cliente</span>
                </div>
                {% endif %}
            </div>

            <!-- Detalles de la venta -->
            <div class="boleta-section">
                <h5><i class="fas fa-shopping-cart"></i> Detalles de la Venta</h5>
                <!-- AHORA LA LÓGICA ES MÁS SIMPLE: mostramos el producto de esta venta específica -->
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th class="text-center">Cantidad</th>
                                <th class="text-end">Precio Unit.</th>
                                <th class="text-end">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <!-- AHORA ACCEDEMOS a venta.producto -->
                                <td>{{ venta.producto.nombre if venta.producto else 'N/A' }}</td>
                                <td class="text-center">{{ venta.cantidad }}</td>
                                <td class="text-end">{{ (venta.producto.precio_unitario if venta.producto else 0)|currency }}</td>
                                <td class="text-end">{{ venta.total|currency }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Información del vendedor -->
            <div class="boleta-section">
                <h5><i class="fas fa-user-tie"></i> Vendedor</h5>
                <div class="boleta-row">
                    <span><strong>Nombre:</strong></span>
                    <!-- AHORA ACCEDEMOS a venta.usuario -->
                    <span>{{ venta.usuario.nombre if venta.usuario else 'N/A' }} {{ venta.usuario.ap_pat if venta.usuario else '' }}</span>
                </div>
            </div>

            <!-- Total -->
            <div class="boleta-total">
                <div class="boleta-row">
                    <span><strong>TOTAL:</strong></span>
                    <span><strong>{{ venta.total|currency }}</strong></span>
                </div>
            </div>

            <div class="text-center mt-4">
                <p class="small text-muted">Gracias por su compra.</p>
            </div>
        </div>

        <!-- Botones de acción -->
        <div class="text-center mt-4 mb-4">
            <button class="btn btn-primary me-2" onclick="window.print()"><i class="fas fa-print"></i> Imprimir</button>
            <a href="{{ url_for('product_html.dashboard') }}" class="btn btn-secondary me-2"><i class="fas fa-home"></i> Dashboard</a>
            <a href="{{ url_for('sale_html.registrar_venta_page') }}" class="btn btn-success me-2"><i class="fas fa-plus"></i> Nueva Venta</a>
            <a href="{{ url_for('sale_html.historial_ventas_page') }}" class="btn btn-info"><i class="fas fa-history"></i> Historial</a>
        </div>
    </div>
</body>
</html>
